<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Alan R. Vazquez">
  <title>IN5148 Statistics and Data Science with Applications in Engineering – Classification Trees</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link rel="stylesheet" href="style.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Classification Trees</h1>
  <p class="subtitle">IN5148: Statistics and Data Science with Applications in Engineering</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alan R. Vazquez 
</div>
        <p class="quarto-title-affiliation">
            Department of Industrial Engineering
          </p>
    </div>
</div>

</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<p><br></p>
<ol type="1">
<li>Introduction</li>
<li>Classification Trees</li>
<li>Classification Algorithm Metrics</li>
</ol>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="load-the-libraries" class="slide level2">
<h2>Load the libraries</h2>
<p>Before we start, let’s import the data science libraries into Python.</p>
<div id="febc5f82" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="co"># Importing necessary libraries</span></span>
<span id="cb1-2"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-6"><a></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb1-7"><a></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb1-8"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-9"><a></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, ConfusionMatrixDisplay </span>
<span id="cb1-10"><a></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, recall_score, precision_score</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here, we use specific functions from the <strong>pandas</strong>, <strong>matplotlib</strong>, <strong>seaborn</strong> and <strong>sklearn</strong> libraries in Python.</p>
</section>
<section id="main-data-science-problems" class="slide level2">
<h2>Main data science problems</h2>
<p><br></p>
<p><span style="color:green;"><strong>Regression Problems</strong></span>. The response is numerical. For example, a person’s income, the value of a house, or a patient’s blood pressure.</p>
<p><span style="color:blue;"><strong>Classification Problems</strong></span>. The response is categorical and involves <em>K</em> different categories. For example, the brand of a product purchased (A, B, C) or whether a person defaults on a debt (yes or no).</p>
<p>The predictors (<span class="math inline">\(\boldsymbol{X}\)</span>) can be <em>numerical</em> or <em>categorical</em>.</p>
</section>
<section id="main-data-science-problems-1" class="slide level2">
<h2>Main data science problems</h2>
<p><br></p>
<p><span style="color:gray;"><strong>Regression Problems</strong>. The response is numerical. For example, a person’s income, the value of a house, or a patient’s blood pressure.</span></p>
<p><span style="color:blue;"><strong>Classification Problems</strong></span>. The response is categorical and involves <em>K</em> different categories. For example, the brand of a product purchased (A, B, C) or whether a person defaults on a debt (yes or no).</p>
<p>The predictors (<span class="math inline">\(\boldsymbol{X}\)</span>) can be <em>numerical</em> or <em>categorical</em>.</p>
</section>
<section id="terminology" class="slide level2">
<h2>Terminology</h2>
<p><br><br></p>
<p>Explanatory variables or predictors:</p>
<ul>
<li><span class="math inline">\(X\)</span> represents an explanatory variable or predictor.</li>
<li><span class="math inline">\(\boldsymbol{X} = (X_1, X_2, \ldots, X_p)\)</span> represents a collection of <span class="math inline">\(p\)</span> predictors.</li>
</ul>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p><br></p>
<p><span style="text-decoration: underline;">Response</span>:</p>
<ul>
<li class="fragment"><p><span class="math inline">\(Y\)</span> is a <span style="color:darkgreen;"><strong>categorical variable</strong></span> that takes <span style="color:darkgreen;"><strong>2 categories</strong></span> or <span style="color:darkgreen;"><strong>classes</strong></span>.</p></li>
<li class="fragment"><p>For example, <span class="math inline">\(Y\)</span> can take <span style="color:darkgreen;">0</span> or <span style="color:darkgreen;">1</span>, <span style="color:darkgreen;">A</span> or <span style="color:darkgreen;">B</span>, <span style="color:darkgreen;">no</span> or <span style="color:darkgreen;">yes</span>, <span style="color:darkgreen;">spam</span> or <span style="color:darkgreen;">no spam</span>.</p></li>
<li class="fragment"><p>When classes are strings, they are usually encoded as 0 and 1.</p>
<ul>
<li class="fragment">The <strong>target class</strong> is the one for which <span class="math inline">\(Y = 1\)</span>.</li>
<li class="fragment">The <strong>reference class</strong> is the one for which <span class="math inline">\(Y = 0\)</span>.</li>
</ul></li>
</ul>
</section>
<section id="classification-algorithms" class="slide level2">
<h2>Classification algorithms</h2>
<p><br></p>
<p>Classification algorithms use predictor values <span style="color:blue;">to predict the class</span> of the response (target or reference).</p>
<p><br></p>
<p>That is, for an unseen record, they use predictor values to predict whether the record belongs to the target class or not.</p>
<p><br></p>
<p>Technically, <span style="color:purple;"><strong>they predict the probability</strong></span> that the record belongs to the target class.</p>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<p><br><br></p>
<p><span style="color:darkgreen;"><strong>Goal</strong></span>: Develop a function <span class="math inline">\(C(\boldsymbol{X})\)</span> for predicting <span class="math inline">\(Y = \{0, 1\}\)</span> from <span class="math inline">\(\boldsymbol{X}\)</span>.</p>
<p><br></p>
<div class="fragment">
<p>To achieve this goal, most algorithms consider functions <span class="math inline">\(C(\boldsymbol{X})\)</span> that <span style="color:brown;"><strong>predict the probability</strong></span> that <span class="math inline">\(Y\)</span> takes the value of 1.</p>
<p><br></p>
</div>
<div class="fragment">
<p>A probability for each class can be very useful for gauging the model’s confidence about the predicted classification.</p>
</div>
</section>
<section id="example-1" class="slide level2">
<h2>Example 1</h2>
<p>Consider a spam filter where <span class="math inline">\(Y\)</span> is the email type.</p>
<ul>
<li>The target class is spam. In this case, <span class="math inline">\(Y=1\)</span>.</li>
<li>The reference class is not spam. In this case, <span class="math inline">\(Y=0\)</span>.</li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/spam.png" class="quarto-figure quarto-figure-center" width="556" height="178"></p>
</figure>
</div>
</div>
<div class="fragment">
<p>Both emails would be classified as spam. However, we would have greater confidence in our classification for the second email.</p>
</div>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<p><br></p>
<p>Technically, <span class="math inline">\(C(\boldsymbol{X})\)</span> works with the <em>conditional probability</em>:</p>
<p><span class="math display">\[P(Y = 1 | X_1 = x_1, X_2 = x_2, \ldots, X_p = x_p) = P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\]</span></p>
<p>In words, this is the probability that <span class="math inline">\(Y\)</span> takes a value of 1 <span style="color:brown;"><strong>given that</strong></span> the predictors <span class="math inline">\(\boldsymbol{X}\)</span> have taken the values <span class="math inline">\(\boldsymbol{x} = (x_1, x_2, \ldots, x_p)\)</span>.</p>
<p><br></p>
<div class="fragment">
<p>The conditional probability that <span class="math inline">\(Y\)</span> takes the value of 0 is</p>
<p><span class="math display">\[P(Y = 0 | \boldsymbol{X} = \boldsymbol{x}) = 1 - P(Y = 1 | \boldsymbol{X} = \boldsymbol{x}).\]</span></p>
</div>
</section>
<section id="bayes-classifier" class="slide level2">
<h2>Bayes classifier</h2>
<p><br></p>
<p>It turns out that, if we know the true structure of <span class="math inline">\(P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\)</span>, we can build a good classification function called the <span style="color:darkblue;"><strong>Bayes classifier</strong></span>:</p>
<p><span class="math display">\[C(\boldsymbol{X}) =
    \begin{cases}
      1, &amp; \text{if}\ P(Y = 1 | \boldsymbol{X} = \boldsymbol{x}) &gt; 0.5 \\
      0, &amp; \text{if}\ P(Y = 1 | \boldsymbol{X} = \boldsymbol{x}) \leq 0.5
    \end{cases}.\]</span></p>
<p>This function classifies to the most probable class using the conditional distribution <span class="math inline">\(P(Y | \boldsymbol{X} = \boldsymbol{x})\)</span>.</p>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p><br></p>
<p><span style="color:red;">HOWEVER, we don’t (and will never) know the true form of <span class="math inline">\(P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\)</span>!</span></p>
<p><br></p>
<div class="fragment">
<p>To overcome this issue, we several standard solutions:</p>
<ul>
<li class="fragment"><span style="color:brown;"><strong>Logistic Regression</strong></span>: Impose an structure on <span class="math inline">\(P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\)</span>. This was covered in IN1002B.</li>
<li class="fragment"><span style="color:darkblue;"><strong>Classification Trees</strong></span>: Estimate <span class="math inline">\(P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\)</span> directly. What we will cover today.</li>
<li class="fragment"><span style="color:orange;"><strong>Ensemble methods</strong></span> and <span style="color:darkgreen;"><strong><em>K</em>-Nearest Neighbours</strong></span>: Estimate <span class="math inline">\(P(Y = 1 | \boldsymbol{X} = \boldsymbol{x})\)</span> directly. (If time permits).</li>
</ul>
</div>
</section>
<section id="two-datasets" class="slide level2">
<h2>Two datasets</h2>
<p><br><br></p>
<p>The application of data science algorithms needs two data sets:</p>
<ul>
<li class="fragment"><p><span style="color:blue;"><strong>Training data</strong></span> is data that we use to train or construct the estimated function <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p></li>
<li class="fragment"><p><span style="color:green;"><strong>Test data</strong></span> is data that we use to evaluate the predictive performance of <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span> only.</p></li>
</ul>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/training.png" width="256"></p>
</div><div class="column" style="width:70%;">
<p><br></p>
<p>A random sample of <span class="math inline">\(n\)</span> observations.</p>
<p>Use it to <strong>construct</strong> <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p>
</div></div>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/test.png" width="262"></p>
</div><div class="column" style="width:70%;">
<p>Another random sample of <span class="math inline">\(n_t\)</span> observations, which is independent of the training data.</p>
<p>Use it to <strong>evaluate</strong> <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p>
</div></div>
</section>
<section id="validation-dataset" class="slide level2">
<h2>Validation dataset</h2>
<p>In many practical situations, a test dataset is not available. To overcome this issue, we use a <span style="color:orange;"><strong>validation dataset</strong></span>.</p>

<img data-src="images/validation.png" class="quarto-figure quarto-figure-center r-stretch" width="645"><div class="fragment">
<p><strong>Idea</strong>: Apply model to your <span style="color:orange;"><strong>validation dataset</strong></span> to mimic what will happen when you apply it to test dataset.</p>
</div>
</section>
<section id="example-2-identifying-counterfeit-banknotes" class="slide level2">
<h2>Example 2: Identifying Counterfeit Banknotes</h2>
<p><br></p>

<img data-src="images/clipboard-270396609.png" class="r-stretch"></section>
<section id="dataset" class="slide level2">
<h2>Dataset</h2>
<p>The data is located in the file “banknotes.xlsx”.</p>
<div id="e405b584" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>bank_data <span class="op">=</span> pd.read_excel(<span class="st">"banknotes.xlsx"</span>)</span>
<span id="cb2-2"><a></a><span class="co"># Set response variable as categorical.</span></span>
<span id="cb2-3"><a></a>bank_data[<span class="st">'Status'</span>] <span class="op">=</span> pd.Categorical(bank_data[<span class="st">'Status'</span>])</span>
<span id="cb2-4"><a></a>bank_data.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Status</th>
<th data-quarto-table-cell-role="th">Left</th>
<th data-quarto-table-cell-role="th">Right</th>
<th data-quarto-table-cell-role="th">Bottom</th>
<th data-quarto-table-cell-role="th">Top</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>genuine</td>
<td>131.0</td>
<td>131.1</td>
<td>9.0</td>
<td>9.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>genuine</td>
<td>129.7</td>
<td>129.7</td>
<td>8.1</td>
<td>9.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>genuine</td>
<td>129.7</td>
<td>129.7</td>
<td>8.7</td>
<td>9.6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>genuine</td>
<td>129.7</td>
<td>129.6</td>
<td>7.5</td>
<td>10.4</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>genuine</td>
<td>129.6</td>
<td>129.7</td>
<td>10.4</td>
<td>7.7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="how-do-we-generate-validation-data" class="slide level2">
<h2>How do we generate validation data?</h2>
<p>We split the current dataset into a training and a validation dataset. To this end, we use the function <code>train_test_split()</code> from <strong>scikit-learn</strong>.</p>
<p><br></p>
<p>The function has three main inputs:</p>
<ul>
<li>A pandas dataframe with the predictor columns only.</li>
<li>A pandas dataframe with the response column only.</li>
<li>The parameter <code>test_size</code> which sets the portion of the dataset that will go to the validation set.</li>
</ul>
</section>
<section id="create-the-predictor-matrix" class="slide level2">
<h2>Create the predictor matrix</h2>
<p>We use the function <code>.drop()</code> from <strong>pandas</strong>. This function drops one or more columns from a data frame. Let’s drop the response column <code>Status</code> and store the result in <code>X_full</code>.</p>
<div id="8f17bc0b" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="co"># Set full matrix of predictors.</span></span>
<span id="cb3-2"><a></a>X_full <span class="op">=</span> bank_data.drop(columns <span class="op">=</span> [<span class="st">'Status'</span>]) </span>
<span id="cb3-3"><a></a>X_full.head(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Left</th>
<th data-quarto-table-cell-role="th">Right</th>
<th data-quarto-table-cell-role="th">Bottom</th>
<th data-quarto-table-cell-role="th">Top</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>131.0</td>
<td>131.1</td>
<td>9.0</td>
<td>9.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>129.7</td>
<td>129.7</td>
<td>8.1</td>
<td>9.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>129.7</td>
<td>129.7</td>
<td>8.7</td>
<td>9.6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>129.7</td>
<td>129.6</td>
<td>7.5</td>
<td>10.4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="create-the-response-column" class="slide level2">
<h2>Create the response column</h2>
<p>We use the function <code>.filter()</code> from <strong>pandas</strong> to extract the column <code>Status</code> from the data frame. We store the result in <code>Y_full</code>.</p>
<div id="71ab0e06" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># Set full matrix of responses.</span></span>
<span id="cb4-2"><a></a>Y_full <span class="op">=</span> bank_data.<span class="bu">filter</span>([<span class="st">'Status'</span>])</span>
<span id="cb4-3"><a></a>Y_full.head(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>genuine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>genuine</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>genuine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>genuine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="set-the-target-category" class="slide level2">
<h2>Set the target category</h2>
<p>To set the target category in the response we use the <code>get_dummies()</code> function.</p>
<div id="eda0c18d" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="co"># Create dummy variables.</span></span>
<span id="cb5-2"><a></a>Y_dummies <span class="op">=</span> pd.get_dummies(Y_full, dtype <span class="op">=</span> <span class="st">'int'</span>)</span>
<span id="cb5-3"><a></a></span>
<span id="cb5-4"><a></a><span class="co"># Select target variable.</span></span>
<span id="cb5-5"><a></a>Y_target_full <span class="op">=</span> Y_dummies[<span class="st">'Status_counterfeit'</span>]</span>
<span id="cb5-6"><a></a></span>
<span id="cb5-7"><a></a><span class="co"># Show target variable.</span></span>
<span id="cb5-8"><a></a>Y_target_full.head() </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0    0
1    0
2    0
3    0
4    0
Name: Status_counterfeit, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="lets-partition-the-dataset" class="slide level2">
<h2>Let’s partition the dataset</h2>
<p><br></p>
<div id="ec8d4851" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb7-2"><a></a>X_train, X_valid, Y_train, Y_valid <span class="op">=</span> train_test_split(X_full, Y_target_full, </span>
<span id="cb7-3"><a></a>                                                      test_size <span class="op">=</span> <span class="fl">0.3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>The function makes a clever partition of the data using the <em>empirical</em> distribution of the response.</p></li>
<li><p>Technically, it splits the data so that the distribution of the response under the training and validation sets is similar.</p></li>
<li><p>Usually, the proportion of the dataset that goes to the validation set is 20% or 30%.</p></li>
</ul>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p>The predictors and response in the training dataset are in the objects <code>X_train</code> and <code>Y_train</code>, respectively. We compile these objects into a single dataset using the function <code>.concat()</code> from <strong>pandas</strong>. The argument <code>axis = 1</code> tells <code>.concat()</code> to concatenate the datasets by their rows.</p>
<div id="dd54363d" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a>training_dataset <span class="op">=</span> pd.concat([X_train, Y_train], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb8-2"><a></a>training_dataset.head(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Left</th>
<th data-quarto-table-cell-role="th">Right</th>
<th data-quarto-table-cell-role="th">Bottom</th>
<th data-quarto-table-cell-role="th">Top</th>
<th data-quarto-table-cell-role="th">Status_counterfeit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">173</th>
<td>129.6</td>
<td>130.0</td>
<td>10.4</td>
<td>11.6</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">171</th>
<td>130.6</td>
<td>130.4</td>
<td>12.0</td>
<td>10.2</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">151</th>
<td>129.9</td>
<td>129.7</td>
<td>11.9</td>
<td>10.1</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">69</th>
<td>130.2</td>
<td>130.2</td>
<td>8.0</td>
<td>11.2</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p>Equivalently, the predictors and response in the validation dataset are in the objects <code>X_valid</code> and <code>Y_valid</code>, respectively.</p>
<div id="9ec0af27" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>validation_dataset <span class="op">=</span> pd.concat([X_valid, Y_valid], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb9-2"><a></a>validation_dataset.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Left</th>
<th data-quarto-table-cell-role="th">Right</th>
<th data-quarto-table-cell-role="th">Bottom</th>
<th data-quarto-table-cell-role="th">Top</th>
<th data-quarto-table-cell-role="th">Status_counterfeit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>129.7</td>
<td>129.7</td>
<td>8.1</td>
<td>9.5</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">130</th>
<td>130.2</td>
<td>130.0</td>
<td>10.7</td>
<td>10.5</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">154</th>
<td>130.3</td>
<td>130.0</td>
<td>11.0</td>
<td>11.5</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">197</th>
<td>130.3</td>
<td>130.4</td>
<td>10.6</td>
<td>11.1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>130.0</td>
<td>130.0</td>
<td>7.4</td>
<td>10.5</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="work-on-your-training-dataset" class="slide level2">
<h2>Work on your training dataset</h2>
<p>After we have partitioned the data, we <strong>work on the</strong> <span style="color:blue;"><strong>training data</strong></span> to develop our predictive pipeline.</p>
<p>The pipeline has two main steps:</p>
<ol type="1">
<li>Data preprocessing.</li>
<li>Model development.</li>
</ol>
<p>We will now discuss preprocessing techniques applied to the predictor columns in the training dataset.</p>
<p>Note that all preprocessing techniques will also be applied to the <span style="color:orange;"><strong>validation</strong></span> and <span style="color:green;"><strong>test</strong></span> datasets to prepare it for your model!</p>
</section></section>
<section>
<section id="classification-trees" class="title-slide slide level1 center">
<h1>Classification Trees</h1>

</section>
<section id="decision-tree" class="slide level2">
<h2>Decision tree</h2>
<p>It is a supervised learning algorithm that predicts or classifies observations using a hierarchical tree structure.</p>
<p><br></p>
<p>Main characteristics:</p>
<ul>
<li><p>Simple and useful for interpretation.</p></li>
<li><p>Can handle numerical and categorical predictors and responses.</p></li>
<li><p>Computationally efficient.</p></li>
<li><p>Nonparametric technique.</p></li>
</ul>
</section>
<section id="basic-idea-of-a-decision-tree" class="slide level2">
<h2>Basic idea of a decision tree</h2>
<p>Stratify or segment the prediction space into several simpler regions.</p>
<div id="7f6a9460" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-10-output-1.png" class="quarto-figure quarto-figure-center" width="877" height="493"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="b804a2da" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-11-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_plot.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-8" class="slide level2">
<h2></h2>

<img data-src="images/tree_scheme.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="how-do-you-build-a-decision-tree" class="slide level2">
<h2>How do you build a decision tree?</h2>
<p><br><br></p>
<p>Building decision trees involves two main procedures:</p>
<ol type="1">
<li><p><span style="color:darkblue;">Grow a large tree.</span></p></li>
<li><p><span style="color:darkblue;">Prune the tree to prevent overfitting.</span></p></li>
</ol>
<p>After building a “good” tree, we can predict new observations that are not in the data set we used to build it.</p>
</section>
<section id="how-do-we-grow-a-tree" class="slide level2">
<h2>How do we grow a tree?</h2>
<p><br></p>
<div class="fragment">
<p><strong>Using the CART algorithm!</strong></p>
<ul>
<li class="fragment"><p>The algorithm uses a recursive binary splitting strategy that builds the tree using a greedy top-down approach.</p></li>
<li class="fragment"><p>Basically, at a given node, it considers all variables and all possible splits of that variable. Then, for classification, it chooses the best variable and splits it that <strong>minimizes</strong> the so-called <span style="color:purple;"><strong><em>impurity</em></strong></span>.</p></li>
</ul>
</div>
</section>
<section id="section-9" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="d6ef3043" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-12-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</div>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="659dd248" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-13-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</div>
</section>
<section id="section-11" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="0ff7dffd" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-14-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</div>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="6413f5b4" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-15-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</div>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="aa0d53df" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-16-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</div>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="8c6df3dc" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-17-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-15" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="991ab802" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-18-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_2.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-16" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="8774c890" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-19-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_2.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-17" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="1de90ca3" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-20-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_2.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-18" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="2c14f92a" class="cell" data-execution_count="20">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-21-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_2.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-19" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="a1fe8f37" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-22-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_4.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-20" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="339ea25b" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-23-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_sequence_6.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-21" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:40%;">
<p>We repeat the partitioning process until the terminal nodes have no less than, say, 5 observations.</p>
</div><div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/full_tree.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="what-is-impurity" class="slide level2">
<h2>What is impurity?</h2>
<p>Node impurity refers to the homogeneity of the response classes at that node.</p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/Impurity1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/Impurity2.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
<p><span style="color:darkgray;"><em>The CART algorithm minimizes impurity between tree nodes.</em></span></p>
</section>
<section id="how-do-we-measure-impurity" class="slide level2">
<h2>How do we measure impurity?</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:40%;">
<p>There are three different metrics for impurity:</p>
<ul>
<li><p>Risk of misclassification.</p></li>
<li><p>Cross entropy.</p></li>
<li><p>Gini impurity index.</p></li>
</ul>
</div><div class="column" style="width:60%;">
<p><img data-src="images/Metrics1.png" class="quarto-figure quarto-figure-center" width="469"> <img data-src="images/Metrics2.png" class="quarto-figure quarto-figure-center" width="396"></p>
<div style="font-size: 50%;">
<p>Proportion of elements in a class</p>
</div>
</div></div>
</div>
</section>
<section id="pruning-the-tree" class="slide level2">
<h2>Pruning the tree</h2>
<p>To avoid overfitting, we pruned some of the tree’s branches. More specifically, we collapsed two internal (non-terminal) nodes.</p>

<img data-src="images/clipboard-1949573140.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="section-22" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="3d09d8ea" class="cell" data-execution_count="23">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-24-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_plot.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-23" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="6decd6e4" class="cell" data-execution_count="24">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-25-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="560"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/tree_plot_simple.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="section-24" class="slide level2">
<h2></h2>
<p><br><br><br></p>
<p>To prune a tree, we use an advanced algorithm to measure the contribution of the tree’s branches.</p>
<p>The algorithm has a tuning parameter called <span class="math inline">\(\alpha\)</span>, which <strong>places greater weight on the number of tree nodes</strong> (or size):</p>
<ul>
<li><p>Large values of <span class="math inline">\(\alpha\)</span> result in small trees with few nodes.</p></li>
<li><p>Small values of <span class="math inline">\(\alpha\)</span> result in large trees with many nodes.</p></li>
</ul>
</section>
<section id="in-python" class="slide level2">
<h2>In Python</h2>
<p><br></p>
<p>In Python, we can use the <code>DecisionTreeClassifier()</code> and <code>fit()</code> functions from <strong>scikit-learn</strong> to train a decision tree.</p>
<div id="515bdcb7" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="co"># We tell Python we want a classification tree</span></span>
<span id="cb10-2"><a></a>clf <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">507134</span>)</span>
<span id="cb10-3"><a></a></span>
<span id="cb10-4"><a></a><span class="co"># We train the classification tree using the training data.</span></span>
<span id="cb10-5"><a></a>clf.fit(X_train, Y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The parameters <code>max_depth</code> of <code>DecisionTreeClassifier()</code> controls the depth of the tree. The parameter <code>random_state</code> allows you to reproduce the same tree in different runs of the Python code.</p>
</section>
<section id="plotting-the-tree" class="slide level2">
<h2>Plotting the tree</h2>
<p><br></p>
<p>To see the decision tree, we use the <code>plot_tree</code> function from <strong>scikit-learn</strong> and some commands from <strong>matplotlib</strong>. Specifically, we use the <code>plt.figure()</code> functions to define the size of the figure and <code>plt.show()</code> to display the figure.</p>
<div id="87bac9d0" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb11-2"><a></a>plot_tree(clf, filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-3"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-25" class="slide level2">
<h2></h2>
<p><br></p>
<div id="b8a8bf1c" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-28-output-1.png" class="quarto-figure quarto-figure-center" width="614" height="463"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="implementation-details" class="slide level2">
<h2>Implementation details</h2>
<ul>
<li><p>Categorical predictors with unordered levels <span class="math inline">\(\{A, B, C\}\)</span>. We order the levels in a specific way (works for binary and regression problems).</p></li>
<li><p>Predictors with missing values. For quantitative predictors, we use multiple imputation. For categorical predictors, we create a new “NA” level.</p></li>
<li><p>Tertiary or quartary splits. There is not much improvement.</p></li>
<li><p>Diagonal splits (using a linear combination for partitioning). These can lead to improvement, but they impair interpretability.</p></li>
</ul>
</section>
<section id="apply-penalty-for-large-trees" class="slide level2">
<h2>Apply penalty for large trees</h2>
<p>Now, let’s illustrate the pruning technique to find a small decision tree that performs well. To do this, we will train several decision trees using different values of the <span class="math inline">\(\alpha\)</span> parameter, which weighs the contribution of the tree branches.</p>
<p><br></p>
<p>In Python, this is achieved using the <code>cost_complexity_pruning_path()</code> function with the following syntax.</p>
<div id="db2a33d2" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>path <span class="op">=</span> clf.cost_complexity_pruning_path(X_train, Y_train)</span>
<span id="cb12-2"><a></a>ccp_alphas, impurities <span class="op">=</span> path.ccp_alphas, path.impurities</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-26" class="slide level2">
<h2></h2>
<p>The <code>ccp_alphas</code> and <code>impurities</code> objects contain the different values of the <span class="math inline">\(\alpha\)</span> parameter used, as well as the impurity performance of the generated trees.</p>
<p>To train a decision tree using different alpha values, we use the following code that iterates over the values contained in <code>ccp_alphas</code>.</p>
<div id="31ad38c2" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>clfs <span class="op">=</span> []</span>
<span id="cb13-2"><a></a><span class="cf">for</span> ccp_alpha <span class="kw">in</span> ccp_alphas:</span>
<span id="cb13-3"><a></a>    clf <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">507134</span>, ccp_alpha<span class="op">=</span>ccp_alpha)</span>
<span id="cb13-4"><a></a>    clf.fit(X_train, Y_train)</span>
<span id="cb13-5"><a></a>    clfs.append(clf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In the next section, we will evaluate the performance of these decision trees.</p>
</section></section>
<section>
<section id="classification-metrics" class="title-slide slide level1 center">
<h1>Classification Metrics</h1>

</section>
<section id="evaluation" class="slide level2">
<h2>Evaluation</h2>
<p><br></p>
<p>We evaluate a classification tree by classifying observations that were not used for training.</p>
<p>That is, we use the classifier to predict categories in the validation data set using only the predictor values from this set.</p>
<p>In Python, we use the commands:</p>
<div id="b6767014" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="co"># Predict classes.</span></span>
<span id="cb14-2"><a></a>predicted_class <span class="op">=</span> clf.predict(X_valid)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-27" class="slide level2">
<h2></h2>
<p><br></p>
<p>The <code>predict()</code> function generates actual classes to which each observation was assigned.</p>
<div id="9ca1dda2" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>predicted_class</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])</code></pre>
</div>
</div>
</section>
<section id="section-28" class="slide level2">
<h2></h2>
<p>The <code>predict_proba()</code> function generates the probabilities used by the algorithm to assign the classes.</p>
<div id="a3c9c1eb" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="co"># Predict probabilities.</span></span>
<span id="cb17-2"><a></a>predicted_probability <span class="op">=</span> clf.predict_proba(X_valid)</span>
<span id="cb17-3"><a></a>predicted_probability</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>array([[0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714],
       [0.50714286, 0.49285714]])</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix" class="slide level2">
<h2>Confusion matrix</h2>
<ul>
<li><p>Table to evaluate the performance of a classifier.</p></li>
<li><p>Compares actual values with the predicted values of a classifier.</p></li>
<li><p>Useful for binary and multiclass classification problems.</p></li>
</ul>

<img data-src="images/confusion_matrix.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="in-python-1" class="slide level2">
<h2>In Python</h2>
<p><br></p>
<p>We calculate the confusion matrix using the homonymous function <strong>scikit-learn</strong>.</p>
<div id="36998578" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="co"># Compute confusion matrix.</span></span>
<span id="cb19-2"><a></a>cm <span class="op">=</span> confusion_matrix(Y_valid, predicted_class)</span>
<span id="cb19-3"><a></a></span>
<span id="cb19-4"><a></a><span class="co"># Show confusion matrix.</span></span>
<span id="cb19-5"><a></a><span class="bu">print</span>(cm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[29  0]
 [31  0]]</code></pre>
</div>
</div>
</section>
<section id="section-29" class="slide level2">
<h2></h2>
<p><br></p>
<p>We can display the confusion matrix using the <code>ConfusionMatrixDisplay()</code> function.</p>
<div id="90c1568e" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>ConfusionMatrixDisplay(cm).plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-35-output-1.png" class="quarto-figure quarto-figure-center" width="514" height="435"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="accuracy" class="slide level2">
<h2>Accuracy</h2>
<p>A simple metric for summarizing the information in the confusion matrix is <strong>accuracy</strong>. It is the proportion of correct classifications for both classes, out of the total classifications performed.</p>
<p>In Python, we calculate accuracy using the <strong>scikit-learn</strong> <code>accuracy_score()</code> function.</p>
<div id="4dac7903" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a>accuracy <span class="op">=</span> accuracy_score(Y_valid, predicted_class)</span>
<span id="cb22-2"><a></a><span class="bu">print</span>( <span class="bu">round</span>(accuracy, <span class="dv">2</span>) )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.48</code></pre>
</div>
</div>
<p>The higher the accuracy, the better the performance of the classifier.</p>
</section>
<section id="lets-get-back-to-the-penalized-trees" class="slide level2">
<h2>Let’s get back to the penalized trees</h2>
<p><br></p>
<p>Now, for each of those trees contained in <code>clfs</code>, we evaluate the performance in terms of accuracy for the training and validation data.</p>
<div id="383fa6ba" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a>train_scores <span class="op">=</span> [clf.score(X_train, Y_train) <span class="cf">for</span> clf <span class="kw">in</span> clfs]</span>
<span id="cb24-2"><a></a>validation_scores <span class="op">=</span> [clf.score(X_valid, Y_valid) <span class="cf">for</span> clf <span class="kw">in</span> clfs]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-30" class="slide level2">
<h2></h2>
<p>We visualize the results using the following plot.</p>
<div id="ef1d433e" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-2"><a></a>ax.set_xlabel(<span class="st">"alpha"</span>)</span>
<span id="cb25-3"><a></a>ax.set_ylabel(<span class="st">"Accuracy"</span>)</span>
<span id="cb25-4"><a></a>ax.set_title(<span class="st">"Accuracy vs alpha for training and validation data"</span>)</span>
<span id="cb25-5"><a></a>ax.plot(ccp_alphas, train_scores, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="st">"train"</span>, drawstyle<span class="op">=</span><span class="st">"steps-post"</span>)</span>
<span id="cb25-6"><a></a>ax.plot(ccp_alphas, validation_scores, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="st">"validation"</span>, drawstyle<span class="op">=</span><span class="st">"steps-post"</span>)</span>
<span id="cb25-7"><a></a>ax.legend()</span>
<span id="cb25-8"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-38-output-1.png" class="quarto-figure quarto-figure-center" width="816" height="455"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="choosing-the-best-tree" class="slide level2">
<h2>Choosing the best tree</h2>
<p>We can see that the best <span class="math inline">\(\alpha\)</span> value for the validation dataset is 0.01.</p>
<p>To train our new reduced tree, we use the <code>DecisionTreeClassifier()</code> function again with the <code>ccp_alpha</code> parameter set to the best <span class="math inline">\(\alpha\)</span> value. The object containing this new tree is <code>clf_simple</code>.</p>
<div id="063e7290" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a><span class="co"># We tell Python that we want a classification tree</span></span>
<span id="cb26-2"><a></a>clf_simple <span class="op">=</span> DecisionTreeClassifier(ccp_alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb26-3"><a></a></span>
<span id="cb26-4"><a></a><span class="co"># We train the classification tree using the training data.</span></span>
<span id="cb26-5"><a></a>clf_simple.fit(X_train, Y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-31" class="slide level2">
<h2></h2>
<p>Once this is done, we can visualize the small tree using the <code>plot_tree()</code> function.</p>
<div id="db944620" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb27-2"><a></a>plot_tree(clf_simple, filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-3"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Classification_files/figure-revealjs/cell-40-output-1.png" class="quarto-figure quarto-figure-center" width="466" height="463"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluation-1" class="slide level2">
<h2>Evaluation</h2>
<p>Let’s compute the accuracy of the pruned tree.</p>
<div id="d5befcb0" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a>single_tree_Y_pred <span class="op">=</span> clf_simple.predict(X_valid)</span>
<span id="cb28-2"><a></a>accuracy <span class="op">=</span> accuracy_score(Y_valid, single_tree_Y_pred)</span>
<span id="cb28-3"><a></a><span class="bu">print</span>( <span class="bu">round</span>(accuracy, <span class="dv">2</span>) )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.97</code></pre>
</div>
</div>
</section>
<section id="comments" class="slide level2">
<h2>Comments</h2>
<p><br></p>
<ul>
<li><p>Accuracy is easy to calculate and interpret.</p></li>
<li><p>It works well when the data set has a balanced class distribution (i.e., cases 1 and 0 are approximately equal).</p></li>
<li><p>However, there are situations in which identifying the target class is more important than the reference class.</p></li>
<li><p>For example, it is not ideal for unbalanced data sets. When one class is much more frequent than the other, accuracy can be misleading.</p></li>
</ul>
</section>
<section id="an-example" class="slide level2">
<h2>An example</h2>
<ul>
<li><p>Let’s say we want to create a classifier that tells us whether a mobile phone company’s customer will churn next month.</p></li>
<li><p>Customers who churn significantly decrease the company’s revenue. That’s why it’s important to retain these customers.</p></li>
<li><p>To retain that customer, the company will send them a text message with an offer for a low-cost mobile plan.</p></li>
<li><p>Ideally, our classifier correctly identifies customers who will churn, so they get the offer and, hopefully, stay.</p></li>
</ul>
</section>
<section id="section-32" class="slide level2">
<h2></h2>
<p><br><br><br></p>
<ul>
<li><p>In other words, we want to avoid making wrong decisions about customers who will churn.</p></li>
<li><p>Wrong decisions about loyal customers aren’t as relevant.</p></li>
<li><p>Because if we classify a loyal customer as one who will churn, the customer will get a good deal. They’ll probably pay less but stay anyway.</p></li>
</ul>
</section>
<section id="another-example" class="slide level2">
<h2>Another example</h2>
<ul>
<li><p>Another example is developing an algorithm (classifier) that can quickly identify patients who may have a rare disease and need a more extensive and expensive medical evaluation.</p></li>
<li><p>The classifier must make correct decisions about patients with the rare disease, so they can be evaluated and eventually treated.</p></li>
<li><p>A healthy patient who is misclassified with the disease will only incur a few extra dollars to pay for the next test, only to discover that the patient does not have the disease.</p></li>
</ul>
</section>
<section id="classification-specific-metrics" class="slide level2">
<h2>Classification-specific metrics</h2>
<p><br><br></p>
<p>To overcome this limitation of accuracy, there are several class-specific metrics. The most popular are:</p>
<ul>
<li><p><span style="color:darkblue;"><strong>Sensitivity</strong></span> or <em>recall</em></p></li>
<li><p><span style="color:darkgreen;"><strong>Precision</strong></span></p></li>
<li><p><strong>Type I error</strong></p></li>
</ul>
<p>These metrics are calculated from the confusion matrix.</p>
</section>
<section id="section-33" class="slide level2">
<h2></h2>

<img data-src="images/classspecific_metrics.png" class="quarto-figure quarto-figure-center r-stretch"><p><span style="color:darkblue;"><strong>Sensitivity</strong></span> or <em>recall</em> = OO/(OO + OR) “How many records of the target class did we predict correctly?”</p>
</section>
<section id="section-34" class="slide level2">
<h2></h2>

<img data-src="images/classspecific_metrics.png" class="quarto-figure quarto-figure-center r-stretch"><p><span style="color:darkgreen;"><strong>Precision</strong></span> = OO/(OO + RO) How many of the records we predicted as target class were classified correctly?</p>
</section>
<section id="section-35" class="slide level2">
<h2></h2>
<p><br></p>
<p>In Python, we compute sensitivity and precision using the following commands:</p>
<div id="d7fef162" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>recall <span class="op">=</span> recall_score(Y_valid, predicted_class)</span>
<span id="cb30-2"><a></a><span class="bu">print</span>( <span class="bu">round</span>(recall, <span class="dv">2</span>) )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0</code></pre>
</div>
</div>
<p><br></p>
<div id="f3483cb3" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a>precision <span class="op">=</span> precision_score(Y_valid, predicted_class)</span>
<span id="cb32-2"><a></a><span class="bu">print</span>( <span class="bu">round</span>(precision, <span class="dv">2</span>) )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0</code></pre>
</div>
</div>
</section>
<section id="section-36" class="slide level2">
<h2></h2>

<img data-src="images/classspecific_metrics.png" class="quarto-figure quarto-figure-center r-stretch"><p><strong>Type I error</strong> = RO/(RO + RR) “How many of the reference records did we incorrectly predict as targets?”</p>
</section>
<section id="section-37" class="slide level2">
<h2></h2>
<p><br><br><br></p>
<p>Unfortunately, there is no simple command to calculate the type-I error in <strong>sklearn</strong>. To overcome this issue, we must calculate it manually.</p>
<div id="83a0fe42" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="co"># Confusion matrix to compute Type-I error</span></span>
<span id="cb34-2"><a></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(Y_valid, predicted_class).ravel()</span>
<span id="cb34-3"><a></a></span>
<span id="cb34-4"><a></a><span class="co"># Type-I error rate = False Positive Rate = FP / (FP + TN)</span></span>
<span id="cb34-5"><a></a>type_I_error <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb34-6"><a></a><span class="bu">print</span>( <span class="bu">round</span>(type_I_error, <span class="dv">2</span>) )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0</code></pre>
</div>
</div>
</section>
<section id="discussion" class="slide level2">
<h2>Discussion</h2>
<p><br></p>
<ul>
<li><p>There is generally a trade-off between sensitivity and Type I error.</p></li>
<li><p>Intuitively, increasing the sensitivity of a classifier is likely to increase Type I error, because more observations are predicted as positive.</p></li>
<li><p>Possible trade-offs between sensitivity and Type I error may be appropriate when there are different penalties or costs associated with each type of error.</p></li>
</ul>
</section>
<section id="activity-2.1-classification-and-metrics-solo-mode" class="slide level2">
<h2>Activity 2.1: Classification and Metrics (solo mode)</h2>
<p>Using the data in the “weight-height.csv” table, apply the CART procedure to build a decision tree useful for predicting a person’s sex based on their weight and height.</p>
<p>In this example, the predictor variables are continuous, and the predictor variable is binary.</p>
<p>Interpret the Precision, Accuracy, Sensitivity, and Type 1 Error values for the validation set. If the software doesn’t report them, perform the calculations using the confusion matrix. Use “Female” as the target class. Discuss the effectiveness of the resulting model.</p>
</section>
<section id="disadvantages-of-decision-trees" class="slide level2">
<h2>Disadvantages of decision trees</h2>
<ul>
<li><p>Decision trees have high variance. A small change in the training data can result in a very different tree.</p></li>
<li><p>It has trouble identifying simple data structures.</p></li>
</ul>

<img data-src="images/clipboard-3265772983.png" class="quarto-figure quarto-figure-center r-stretch"></section></section>
<section id="return-to-main-page" class="title-slide slide level1 center">
<h1><a href="https://alanrvazquez.github.io/TEC-IN5148/">Return to main page</a></h1>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="IN5148_logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Tecnologico de Monterrey</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>