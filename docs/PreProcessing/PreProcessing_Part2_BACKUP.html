<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alan R. Vazquez">

<title>Data preprocessing: Part II – IN5148 Statistics and Data Science with Applications in Engineering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ff63373b1067ca6f91cf1456aa1f00a2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Data preprocessing: Part II</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#agenda" id="toc-agenda" class="nav-link active" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#before-we-start" id="toc-before-we-start" class="nav-link" data-scroll-target="#before-we-start">Before we start</a></li>
  <li><a href="#transforming-predictors" id="toc-transforming-predictors" class="nav-link" data-scroll-target="#transforming-predictors">Transforming predictors</a>
  <ul class="collapse">
  <li><a href="#categorical-predictors" id="toc-categorical-predictors" class="nav-link" data-scroll-target="#categorical-predictors">Categorical predictors</a></li>
  <li><a href="#dummy-variables" id="toc-dummy-variables" class="nav-link" data-scroll-target="#dummy-variables">Dummy variables</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example 1</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#training-and-validation-datasets" id="toc-training-and-validation-datasets" class="nav-link" data-scroll-target="#training-and-validation-datasets">Training and validation datasets</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#dealing-with-missing-values" id="toc-dealing-with-missing-values" class="nav-link" data-scroll-target="#dealing-with-missing-values">Dealing with missing values</a></li>
  <li><a href="#example-1-cont." id="toc-example-1-cont." class="nav-link" data-scroll-target="#example-1-cont.">Example 1 (cont.)</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#a-drawback" id="toc-a-drawback" class="nav-link" data-scroll-target="#a-drawback">A drawback</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a></li>
  <li><a href="#dummy-variables-in-python" id="toc-dummy-variables-in-python" class="nav-link" data-scroll-target="#dummy-variables-in-python">Dummy variables in Python</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a></li>
  <li><a href="#transforming-numerical-predictors" id="toc-transforming-numerical-predictors" class="nav-link" data-scroll-target="#transforming-numerical-predictors">Transforming numerical predictors</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2</a></li>
  <li><a href="#the-predictors" id="toc-the-predictors" class="nav-link" data-scroll-target="#the-predictors">The predictors</a></li>
  <li><a href="#read-the-dataset" id="toc-read-the-dataset" class="nav-link" data-scroll-target="#read-the-dataset">Read the dataset</a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a></li>
  <li><a href="#distribution-of-dis" id="toc-distribution-of-dis" class="nav-link" data-scroll-target="#distribution-of-dis">Distribution of <code>DIS</code></a></li>
  <li><a href="#problems-with-strong-skewness" id="toc-problems-with-strong-skewness" class="nav-link" data-scroll-target="#problems-with-strong-skewness">Problems with strong skewness</a></li>
  <li><a href="#box-cox-transformation" id="toc-box-cox-transformation" class="nav-link" data-scroll-target="#box-cox-transformation">Box-Cox Transformation</a></li>
  <li><a href="#in-python" id="toc-in-python" class="nav-link" data-scroll-target="#in-python">In Python</a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"></a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"></a></li>
  <li><a href="#value-of-lambda" id="toc-value-of-lambda" class="nav-link" data-scroll-target="#value-of-lambda">Value of <span class="math inline">\(\lambda\)</span></a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul></li>
  <li><a href="#reducing-the-number-of-predictors" id="toc-reducing-the-number-of-predictors" class="nav-link" data-scroll-target="#reducing-the-number-of-predictors">Reducing the number of predictors</a>
  <ul class="collapse">
  <li><a href="#removing-predictors" id="toc-removing-predictors" class="nav-link" data-scroll-target="#removing-predictors">Removing predictors</a></li>
  <li><a href="#near-zero-variance-predictors" id="toc-near-zero-variance-predictors" class="nav-link" data-scroll-target="#near-zero-variance-predictors">Near-Zero variance predictors</a></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">Example 3</a></li>
  <li><a href="#training-and-validation-datasets-1" id="toc-training-and-validation-datasets-1" class="nav-link" data-scroll-target="#training-and-validation-datasets-1">Training and validation datasets</a></li>
  <li><a href="#in-python-1" id="toc-in-python-1" class="nav-link" data-scroll-target="#in-python-1">In Python</a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"></a></li>
  <li><a href="#between-predictor-correlation" id="toc-between-predictor-correlation" class="nav-link" data-scroll-target="#between-predictor-correlation">Between-predictor correlation</a></li>
  <li><a href="#example-1-cont.-1" id="toc-example-1-cont.-1" class="nav-link" data-scroll-target="#example-1-cont.-1">Example 1 (cont.)</a></li>
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">Correlation matrix</a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"></a></li>
  <li><a href="#section-13" id="toc-section-13" class="nav-link" data-scroll-target="#section-13"></a></li>
  <li><a href="#in-practice" id="toc-in-practice" class="nav-link" data-scroll-target="#in-practice">In practice</a></li>
  </ul></li>
  <li><a href="#standarization" id="toc-standarization" class="nav-link" data-scroll-target="#standarization">Standarization</a>
  <ul class="collapse">
  <li><a href="#predictors-with-different-units" id="toc-predictors-with-different-units" class="nav-link" data-scroll-target="#predictors-with-different-units">Predictors with different units</a></li>
  <li><a href="#section-14" id="toc-section-14" class="nav-link" data-scroll-target="#section-14"></a></li>
  <li><a href="#standarization-1" id="toc-standarization-1" class="nav-link" data-scroll-target="#standarization-1">Standarization</a></li>
  <li><a href="#section-15" id="toc-section-15" class="nav-link" data-scroll-target="#section-15"></a></li>
  <li><a href="#example-1-cont.-2" id="toc-example-1-cont.-2" class="nav-link" data-scroll-target="#example-1-cont.-2">Example 1 (cont.)</a></li>
  <li><a href="#two-predictors-in-original-units" id="toc-two-predictors-in-original-units" class="nav-link" data-scroll-target="#two-predictors-in-original-units">Two predictors in original units</a></li>
  <li><a href="#standarization-in-python" id="toc-standarization-in-python" class="nav-link" data-scroll-target="#standarization-in-python">Standarization in Python</a></li>
  <li><a href="#section-16" id="toc-section-16" class="nav-link" data-scroll-target="#section-16"></a></li>
  <li><a href="#two-predictors-in-standardized-units" id="toc-two-predictors-in-standardized-units" class="nav-link" data-scroll-target="#two-predictors-in-standardized-units">Two predictors in standardized units</a></li>
  <li><a href="#discussion-1" id="toc-discussion-1" class="nav-link" data-scroll-target="#discussion-1">Discussion</a></li>
  </ul></li>
  <li><a href="#return-to-main-page" id="toc-return-to-main-page" class="nav-link" data-scroll-target="#return-to-main-page">Return to main page</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="PreProcessing_Part2_BACKUP.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data preprocessing: Part II</h1>
<p class="subtitle lead">IN5148: Statistics and Data Science with Applications in Engineering</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Alan R. Vazquez </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Industrial Engineering
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="agenda" class="level3">
<h3 class="anchored" data-anchor-id="agenda">Agenda</h3>
<p><br></p>
<ol type="1">
<li>Transforming predictors</li>
<li>Reducing the number of predictors</li>
<li>Standardizing the units of the predictors</li>
</ol>
</section>
<section id="before-we-start" class="level3">
<h3 class="anchored" data-anchor-id="before-we-start">Before we start</h3>
<p><br></p>
<p>Let’s import <strong>scikit-learn</strong> into Python together with the other relevant libraries.</p>
<div id="301d602b" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer, KNNImputer</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer, StandardScaler </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We will not use all the functions from the <strong>scikit-learn</strong> library. Instead, we will use specific functions from the sub-libraries <strong>preprocessing</strong>, <strong>feature_selection</strong>, <strong>model_selection</strong> and <strong>impute</strong>.</p>
</section>
<section id="transforming-predictors" class="level2">
<h2 class="anchored" data-anchor-id="transforming-predictors">Transforming predictors</h2>
<section id="categorical-predictors" class="level3">
<h3 class="anchored" data-anchor-id="categorical-predictors">Categorical predictors</h3>
<p>A <span style="color:darkgreen;"><strong>categorical predictor</strong></span> takes on values that are categories or groups.</p>
<p>. . .</p>
<p>For example:</p>
<ul>
<li><p>Type of school: Public or private.</p></li>
<li><p>Treatment: New or placebo.</p></li>
<li><p>Grade: Passed or not passed.</p></li>
</ul>
<p>. . .</p>
<p>The categories can be represented by names, labels or even numbers. Their use in regression requires <strong>dummy variables</strong>, which are numeric.</p>
</section>
<section id="dummy-variables" class="level3">
<h3 class="anchored" data-anchor-id="dummy-variables">Dummy variables</h3>
<p><br><br></p>
<blockquote class="blockquote">
<p>The traditional choice for a dummy variable is a binary variable, which can only take the values 0 and 1.</p>
</blockquote>
<p><br></p>
<p><strong><em>Initially, a categorical variable with</em></strong> <span class="math inline">\(k\)</span> <strong><em>categories requires</em></strong> <span class="math inline">\(k\)</span> <strong><em>dummy variables.</em></strong></p>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example 1</h3>
<p>A market analyst is studying quality characteristics of cars. Specifically, the analyst is investigating the miles per gallon (mpg) of cars can be predicted using:</p>
<ul>
<li><span class="math inline">\(X_1:\)</span> cylinders. Number of cylinders between 4 and 8</li>
<li><span class="math inline">\(X_2:\)</span> displacement. Engine displacement (cu. inches)</li>
<li><span class="math inline">\(X_3:\)</span> horsepower. Engine horsepower</li>
<li><span class="math inline">\(X_4:\)</span> weight. Vehicle weight (lbs.)</li>
<li><span class="math inline">\(X_5:\)</span> acceleration. Time to accelerate from 0 to 60 mph (sec.)</li>
<li><span class="math inline">\(X_6:\)</span> origin. Origin of car (American, European, Japanese)</li>
</ul>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<p><br><br></p>
<p>The dataset is in the file “auto.xlsx”. Let’s read the data using <strong>pandas</strong>.</p>
<div id="51ec7fb6" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the Excel file into a pandas DataFrame.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>auto_data <span class="op">=</span> pd.read_excel(<span class="st">"auto.xlsx"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set categorical variables.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>auto_data[<span class="st">'origin'</span>] <span class="op">=</span> pd.Categorical(auto_data[<span class="st">'origin'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="training-and-validation-datasets" class="level3">
<h3 class="anchored" data-anchor-id="training-and-validation-datasets">Training and validation datasets</h3>
<p><br></p>
<p>For illustrative purposes, we assume that we want to predict the miles per gallon of a car using the six predictors, <span class="math inline">\(X_1, \ldots, X_6\)</span>.</p>
<p>We create the predictor matrix and response column.</p>
<div id="d02ed327" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of predictors.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>X_full_c <span class="op">=</span> (auto_data</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>           .<span class="bu">filter</span>([<span class="st">'cylinders'</span>, <span class="st">'displacement'</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">'horsepower'</span>, <span class="st">'weight'</span>, <span class="st">'acceleration'</span>, <span class="st">'origin'</span>]))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of responses.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>Y_full_c <span class="op">=</span> auto_data.<span class="bu">filter</span>([<span class="st">'mpg'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1"></h3>
<p><br></p>
<p>We will use a validation dataset with 30% of the observations in <code>auto_data</code>. The other 70% will be in the training dataset.</p>
<div id="c1f80069" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X_train_c, X_valid_c, Y_train_c, Y_valid_c <span class="op">=</span> train_test_split(X_full_c, Y_full_c, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                                      test_size <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                                      random_state <span class="op">=</span> <span class="dv">59227</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2"></h3>
<p><br></p>
<p>Let’s look at the full training dataset.</p>
<div id="e92afcd2" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>training_auto <span class="op">=</span> pd.concat([X_train_c, Y_train_c], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>training_auto.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">mpg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>6</td>
<td>250.0</td>
<td>100</td>
<td>3282</td>
<td>15.0</td>
<td>American</td>
<td>19.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">72</th>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>4098</td>
<td>14.0</td>
<td>American</td>
<td>13.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">389</th>
<td>4</td>
<td>135.0</td>
<td>84</td>
<td>2295</td>
<td>11.6</td>
<td>American</td>
<td>32.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">145</th>
<td>4</td>
<td>90.0</td>
<td>75</td>
<td>2108</td>
<td>15.5</td>
<td>European</td>
<td>24.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11</th>
<td>8</td>
<td>340.0</td>
<td>160</td>
<td>3609</td>
<td>8.0</td>
<td>American</td>
<td>14.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dealing-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-missing-values">Dealing with missing values</h3>
<p><br></p>
<p>The dataset has missing values. In this example, we remove each row with at least one missing value.</p>
<p><br></p>
<div id="de0ecc4a" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with missing values.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>complete_Auto <span class="op">=</span> training_auto.dropna()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="example-1-cont." class="level3">
<h3 class="anchored" data-anchor-id="example-1-cont.">Example 1 (cont.)</h3>
<p>Categorical predictor: Origin of a car. Three categories: American, European and Japanese.</p>
<p>Initially, 3 dummy variables are required:</p>
<p><span class="math display">\[d_1 =
\begin{cases}
1 \text{ if observation is from an American car}\\
0 \text{ otherwise}
\end{cases}\]</span> <span class="math display">\[d_2 =
\begin{cases}
1 \text{ if observation is from an European car}\\
0 \text{ otherwise}
\end{cases}\]</span> <span class="math display">\[d_3 =
\begin{cases}
1 \text{ if observation is from a Japanese car}\\
0 \text{ otherwise}
\end{cases}\]</span></p>
</section>
<section id="section-3" class="level3">
<h3 class="anchored" data-anchor-id="section-3"></h3>
<p>The variable Origin would then be replaced by the three dummy variables</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Origin (<span class="math inline">\(X\)</span>)</th>
<th><span class="math inline">\(d_1\)</span></th>
<th><span class="math inline">\(d_2\)</span></th>
<th><span class="math inline">\(d_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>European</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>European</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Japanese</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="a-drawback" class="level3">
<h3 class="anchored" data-anchor-id="a-drawback">A drawback</h3>
<p><br></p>
<div class="incremental">
<ul class="incremental">
<li><p>A drawback with the initial dummy variables is that they are <span style="color:red;"><strong>linearly dependent</strong></span>. That is, <span class="math inline">\(d_1 + d_2 + d_3 = 1\)</span>.</p></li>
<li><p>Therefore, we can determine the value of <span class="math inline">\(d_1 = 1- d_2 - d_3.\)</span></p></li>
<li><p>Predictive models such as linear regression are sensitive to linear dependencies among predictors.</p></li>
<li><p><strong>The solution is to drop one of the predictor</strong>, say, <span class="math inline">\(d_1\)</span>, from the data.</p></li>
</ul>
</div>
</section>
<section id="section-4" class="level3">
<h3 class="anchored" data-anchor-id="section-4"></h3>
<p>The variable Origin would then be replaced by the three dummy variables.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Origin (<span class="math inline">\(X\)</span>)</th>
<th><span class="math inline">\(d_2\)</span></th>
<th><span class="math inline">\(d_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>European</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>European</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Japanese</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="dummy-variables-in-python" class="level3">
<h3 class="anchored" data-anchor-id="dummy-variables-in-python">Dummy variables in Python</h3>
<p><br></p>
<p>We can get the dummy variables of a categorical variable using the function <code>pd.get_dummies()</code> from <strong>pandas</strong>.</p>
<p>The input of the function is the categorical variable.</p>
<p>The function has an extra argument called <code>drop_first</code> to drop the first dummy variable. It also has the argument <code>dtype</code> to show the values as integers.</p>
<div id="f441c73d" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="op">=</span> pd.get_dummies(complete_Auto[<span class="st">'origin'</span>], drop_first <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                            dtype <span class="op">=</span> <span class="st">'int'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-5" class="level3">
<h3 class="anchored" data-anchor-id="section-5"></h3>
<p><br><br></p>
<div id="e0062779" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dummy_data.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">European</th>
<th data-quarto-table-cell-role="th">Japanese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">72</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">389</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">145</th>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11</th>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-6" class="level3">
<h3 class="anchored" data-anchor-id="section-6"></h3>
<p>Now, to add the dummy variables to the dataset, we use the function <code>concat()</code> from <strong>pandas</strong>.</p>
<div id="d4135578" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>augmented_auto <span class="op">=</span> pd.concat([complete_Auto, dummy_data], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>augmented_auto.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">European</th>
<th data-quarto-table-cell-role="th">Japanese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>6</td>
<td>250.0</td>
<td>100</td>
<td>3282</td>
<td>15.0</td>
<td>American</td>
<td>19.0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">72</th>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>4098</td>
<td>14.0</td>
<td>American</td>
<td>13.0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">389</th>
<td>4</td>
<td>135.0</td>
<td>84</td>
<td>2295</td>
<td>11.6</td>
<td>American</td>
<td>32.0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">145</th>
<td>4</td>
<td>90.0</td>
<td>75</td>
<td>2108</td>
<td>15.5</td>
<td>European</td>
<td>24.0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11</th>
<td>8</td>
<td>340.0</td>
<td>160</td>
<td>3609</td>
<td>8.0</td>
<td>American</td>
<td>14.0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="transforming-numerical-predictors" class="level3">
<h3 class="anchored" data-anchor-id="transforming-numerical-predictors">Transforming numerical predictors</h3>
<p><br></p>
<p>A common problem with a predictor is that it may have a <em>skewed distribution</em>. That is, a distribution that accumulates many observations in smaller or larger values of the predictor.</p>
<p><br></p>
<p>For example, consider the distribution of the predictor <code>DIS</code> (weighted mean of distances to five Boston employment centers) in the “BostonHousing.xlsx” dataset.</p>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example 2</h3>
<p><br></p>
<p>We revisit the “BostonHousing.xlsx” dataset that contains data of houses in Boston, Massachusetts.</p>
<p><br></p>
<p>The <strong>goal</strong> is to predict the median house price in new tracts based on information such as crime rate, pollution, and number of rooms.</p>
<p><br></p>
<p>The <span style="color:darkred;">response</span> is the median value of owner-occupied homes in $1000s, contained in the column <code>MEDV</code>.</p>
</section>
<section id="the-predictors" class="level3">
<h3 class="anchored" data-anchor-id="the-predictors">The predictors</h3>
<div style="font-size: 70%;">
<ul>
<li><code>CRIM</code>: per capita crime rate by town.</li>
<li><code>ZN</code>: proportion of residential land zoned for lots over 25,000 sq.ft.</li>
<li><code>INDUS</code>: proportion of non-retail business acres per town.</li>
<li><code>CHAS</code>: Charles River (‘Yes’ if tract bounds river; ‘No’ otherwise).</li>
<li><code>NOX</code>: nitrogen oxides concentration (parts per 10 million).</li>
<li><code>RM</code>: average number of rooms per dwelling.</li>
<li><code>AGE</code>: proportion of owner-occupied units built prior to 1940.</li>
<li><code>DIS</code>: weighted mean of distances to five Boston employment centers</li>
<li><code>RAD</code>: index of accessibility to radial highways (‘Low’, ‘Medium’, ‘High’).</li>
<li><code>TAX</code>: full-value property-tax rate per $10,000.</li>
<li><code>PTRATIO</code>: pupil-teacher ratio by town.</li>
<li><code>LSTAT</code>: lower status of the population (percent).</li>
</ul>
</div>
</section>
<section id="read-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="read-the-dataset">Read the dataset</h3>
<p>We read the dataset.</p>
<div id="c6bde32c" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Boston_data <span class="op">=</span> pd.read_excel(<span class="st">'BostonHousing.xlsx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br></p>
<p>The variables <code>CHAS</code> and <code>RAD</code> are categorical variables. Therefore, we turn tthem into categorical using <code>.Categorical()</code> function from <strong>pandas</strong>.</p>
<div id="eb26387d" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Boston_data[<span class="st">'CHAS'</span>] <span class="op">=</span> pd.Categorical(Boston_data[<span class="st">'CHAS'</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Boston_data[<span class="st">'RAD'</span>] <span class="op">=</span> pd.Categorical(Boston_data[<span class="st">'RAD'</span>], </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                      categories<span class="op">=</span>[<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>], </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                      ordered<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-7" class="level3">
<h3 class="anchored" data-anchor-id="section-7"></h3>
<p><br></p>
<p>Before we continue, we generate a training dataset with 80% of the observations. To this end, let’s create the predictor matrix and response column.</p>
<div id="2aa6f864" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of predictors.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X_full_b <span class="op">=</span> Boston_data.drop(columns <span class="op">=</span> [<span class="st">'MEDV'</span>]) </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of responses.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>Y_full_b <span class="op">=</span> Boston_data.<span class="bu">filter</span>([<span class="st">'MEDV'</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>X_train_b, X_valid_b, Y_train_b, Y_valid_b <span class="op">=</span> train_test_split(X_full_b, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                                      Y_full_b, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                                      test_size <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                                                      random_state <span class="op">=</span> <span class="dv">59227</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-8" class="level3">
<h3 class="anchored" data-anchor-id="section-8"></h3>
<p><br></p>
<p>The new training dataset we will work with is:</p>
<div id="91334cbb" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Boston_training <span class="op">=</span> pd.concat([X_train_b, Y_train_b], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Boston_training.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CRIM</th>
<th data-quarto-table-cell-role="th">ZN</th>
<th data-quarto-table-cell-role="th">INDUS</th>
<th data-quarto-table-cell-role="th">CHAS</th>
<th data-quarto-table-cell-role="th">NOX</th>
<th data-quarto-table-cell-role="th">RM</th>
<th data-quarto-table-cell-role="th">AGE</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">RAD</th>
<th data-quarto-table-cell-role="th">TAX</th>
<th data-quarto-table-cell-role="th">PTRATIO</th>
<th data-quarto-table-cell-role="th">LSTAT</th>
<th data-quarto-table-cell-role="th">MEDV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">432</th>
<td>6.44405</td>
<td>0.0</td>
<td>18.10</td>
<td>No</td>
<td>0.584</td>
<td>6.425</td>
<td>74.8</td>
<td>2.2004</td>
<td>High</td>
<td>666</td>
<td>20.2</td>
<td>12.03</td>
<td>16.1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">108</th>
<td>0.12802</td>
<td>0.0</td>
<td>8.56</td>
<td>No</td>
<td>0.520</td>
<td>6.474</td>
<td>97.1</td>
<td>2.4329</td>
<td>Medium</td>
<td>384</td>
<td>20.9</td>
<td>12.27</td>
<td>19.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">97</th>
<td>0.12083</td>
<td>0.0</td>
<td>2.89</td>
<td>No</td>
<td>0.445</td>
<td>8.069</td>
<td>76.0</td>
<td>3.4952</td>
<td>Low</td>
<td>276</td>
<td>18.0</td>
<td>4.21</td>
<td>38.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">484</th>
<td>2.37857</td>
<td>0.0</td>
<td>18.10</td>
<td>No</td>
<td>0.583</td>
<td>5.871</td>
<td>41.9</td>
<td>3.7240</td>
<td>High</td>
<td>666</td>
<td>20.2</td>
<td>13.34</td>
<td>20.6</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">217</th>
<td>0.07013</td>
<td>0.0</td>
<td>13.89</td>
<td>No</td>
<td>0.550</td>
<td>6.642</td>
<td>85.1</td>
<td>3.4211</td>
<td>Medium</td>
<td>276</td>
<td>16.4</td>
<td>9.69</td>
<td>28.7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="distribution-of-dis" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-dis">Distribution of <code>DIS</code></h3>
<p>A right-skewed distribution is characterized by the right tail (or the side with higher values) being longer and more extended than the left tail.</p>
<div id="e36f7349" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="fl">3.5</span>)) <span class="co"># Create space for figure.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> Boston_training, x <span class="op">=</span> <span class="st">'DIS'</span>) <span class="co"># Create the histogram.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of DIS"</span>) <span class="co"># Plot title.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"DIS"</span>) <span class="co"># X label</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.show() <span class="co"># Display the plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-15-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="659" height="339"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="problems-with-strong-skewness" class="level3">
<h3 class="anchored" data-anchor-id="problems-with-strong-skewness">Problems with strong skewness</h3>
<p><br></p>
<p>Strong (right or left) skewness in a predictor can:</p>
<ul>
<li>Distort the relationship with the response.</li>
<li>Violate the assumptions of the linear regression model (e.g., linearity, homoscedasticity).</li>
<li>Lead to influential outliers or poor model fit.</li>
</ul>
<p>To correct the skewness of a predictor’s distribution, we can transform the predictor using the <span style="color:orange;"><strong>Box-Cox transformation</strong></span></p>
</section>
<section id="box-cox-transformation" class="level3">
<h3 class="anchored" data-anchor-id="box-cox-transformation">Box-Cox Transformation</h3>
<p><br></p>
<div class="incremental">
<ul class="incremental">
<li><p>The Box-Cox transformation uses a family of power transformations on a predictor <span class="math inline">\(X\)</span> such that <span class="math inline">\(X' = X^{\lambda}\)</span>, where <span class="math inline">\(\lambda\)</span> is a parameter to be determined using the data. When <span class="math inline">\(\lambda = 0,\)</span> this means <span class="math inline">\(X' = \ln(X)\)</span>, where <span class="math inline">\(\ln(\cdot)\)</span> is the natural logarithm.</p></li>
<li><p>The Box-Cox transformation is the element of this family that results in a transformed variable that follows a normal distribution (approximately).</p></li>
<li><p><span style="color:blue;">The variable <span class="math inline">\(X\)</span> must be strictly positive!</span></p></li>
</ul>
</div>
</section>
<section id="in-python" class="level3">
<h3 class="anchored" data-anchor-id="in-python">In Python</h3>
<p>We apply the Box-Cox transformation using the <code>PowerTransformer</code> and <code>fit_transform</code> functions of the <strong>scikit-learn</strong> library.</p>
<div id="53b331c7" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'box-cox'</span>, standardize <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>DIS_transform <span class="op">=</span> pt.fit_transform(Boston_training[[<span class="st">'DIS'</span>]])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br></p>
<p>In the <code>PowerTransformer</code>, the input <code>standardize</code> specifies if we wish to standardize the resulting transformed predictor to have a mean of zero and a standard deviation of one. We do not standardize the predictor yet.</p>
</section>
<section id="section-9" class="level3">
<h3 class="anchored" data-anchor-id="section-9"></h3>
<p>The result from the function is a <strong>numpy</strong> array. However, since we are working with <strong>pandas</strong> dataframes, we must transform the output to this format using the following code.</p>
<div id="bd8be2dd" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>DIS_transform_df <span class="op">=</span> pd.DataFrame(DIS_transform, columns<span class="op">=</span>[<span class="st">'DIS_boxcox'</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>DIS_transform_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DIS_boxcox</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.751469</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0.842035</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1.159532</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1.213652</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1.141146</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-10" class="level3">
<h3 class="anchored" data-anchor-id="section-10"></h3>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Original predictor</p>
<div id="34af492d" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>)) <span class="co"># Create space for figure.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> Boston_training, x <span class="op">=</span> <span class="st">'DIS'</span>) <span class="co"># Create the histogram.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of DIS"</span>) <span class="co"># Plot title.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"DIS"</span>) <span class="co"># X label</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.show() <span class="co"># Display the plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-18-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="585" height="376"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Box-Cox transformation</p>
<div id="0bbc444e" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>)) <span class="co"># Create space for figure.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> DIS_transform_df, x <span class="op">=</span> <span class="st">'DIS_boxcox'</span>) <span class="co"># Create the histogram.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of transformed DIS"</span>) <span class="co"># Plot title.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"DIS (Box-Cox transformation"</span>) <span class="co"># X label</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>plt.show() <span class="co"># Display the plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-19-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="585" height="376"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="value-of-lambda" class="level3">
<h3 class="anchored" data-anchor-id="value-of-lambda">Value of <span class="math inline">\(\lambda\)</span></h3>
<p><br></p>
<p>Recall that the Box-Cox transformation finds the best value of <span class="math inline">\(\lambda\)</span> that makes the transformed predictor <span class="math inline">\(X^\lambda\)</span> to follow a normal distribution.</p>
<p>We can obtain the value of <span class="math inline">\(\lambda\)</span> actually used in the transformation using the following code.</p>
<div id="50261bcd" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the lambda value</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pt.lambdas_)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-0.12343575]</code></pre>
</div>
</div>
<p>This means that the transformed predictor is <span class="math inline">\(X' = X^{-0.123}\)</span>.</p>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p><br><br></p>
<p>The Box-Cox transformation can:</p>
<ul>
<li><p>Make the distribution of a predictor more symmetric.</p></li>
<li><p>Help to linearize the relationship with the response.</p></li>
</ul>
<p>After transformation, the predictor <span class="math inline">\(X'\)</span> must be used instead of the original predictor <span class="math inline">\(X\)</span>.</p>
</section>
</section>
<section id="reducing-the-number-of-predictors" class="level2">
<h2 class="anchored" data-anchor-id="reducing-the-number-of-predictors">Reducing the number of predictors</h2>
<section id="removing-predictors" class="level3">
<h3 class="anchored" data-anchor-id="removing-predictors">Removing predictors</h3>
<p><br></p>
<p>There are potential advantages to removing predictors prior to modeling:</p>
<div class="incremental">
<ul class="incremental">
<li><p>Fewer predictors means decreased computational time and complexity.</p></li>
<li><p>If two predictors are highly-correlated, they are measuring the same underlying information. So, removing one should not compromise the performance of the model.</p></li>
</ul>
</div>
<p>. . .</p>
<p>Here, we will see two techniques to remove predictors.</p>
</section>
<section id="near-zero-variance-predictors" class="level3">
<h3 class="anchored" data-anchor-id="near-zero-variance-predictors">Near-Zero variance predictors</h3>
<p><br></p>
<p>A <strong>near-zero variance predictor variable</strong> is one that has only a handful of unique values that occur with very low frequencies.</p>
<p><br></p>
<p>. . .</p>
<p>If the predictor has a single unique value, then it is called a <strong>zero-variance predictor variable</strong>.</p>
<p><br></p>
<p>. . .</p>
<p>Since the values of this predictor variable do not vary or change at all, this predictor does not provide any information to the model and must be discarded.</p>
</section>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">Example 3</h3>
<p><br></p>
<p>We consider a data set related to Glass identification. The data has 214 glass samples labeled as one of seven glass categories. There are nine predictors including the refractive index (RI) and percentages of eight elements: Na, Mg, Al, Si, K, Ca, Ba, and Fe.</p>
<p>Let’s read the data set.</p>
<div id="e05ba9d5" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Excel file (make sure the file is in your Colab)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>glass_data <span class="op">=</span> pd.read_excel(<span class="st">'glass.xlsx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="training-and-validation-datasets-1" class="level3">
<h3 class="anchored" data-anchor-id="training-and-validation-datasets-1">Training and validation datasets</h3>
<p>Let’s create a training and validation dataset. To this end, we will consider the variable <code>Type</code> as the response and the other numeric variables as the predictors. We will use 80% of the observations for the training dataset. The other 20% of the observations will go to the validation dataset.</p>
<div id="7326a836" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of predictors.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>X_full_g <span class="op">=</span> glass_data.drop(columns <span class="op">=</span> [<span class="st">'Type'</span>]) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set full matrix of responses.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>Y_full_g <span class="op">=</span> glass_data.<span class="bu">filter</span>([<span class="st">'Type'</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>X_train_g, X_valid_g, Y_train_g, Y_valid_g <span class="op">=</span> train_test_split(X_full_g, </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                                      Y_full_g, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                                      test_size <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                                                      random_state <span class="op">=</span> <span class="dv">59227</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="in-python-1" class="level3">
<h3 class="anchored" data-anchor-id="in-python-1">In Python</h3>
<p>We use the function <code>VarianceThreshold()</code> to set the threshold for determining a <em>low</em> sample variance. We also use other functions such as <code>.fit()</code> and <code>.get_support()</code>.</p>
<div id="005cd6af" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set threshold</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> VarianceThreshold(threshold<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply threshold.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>selector.fit(X_train_g)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify predictors with low variance.</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>low_variance_cols <span class="op">=</span> X_train_g.columns[<span class="op">~</span>selector.get_support()]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the list of predictors.</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Low variance columns: </span><span class="sc">{</span>low_variance_cols<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Low variance columns: Index(['RI', 'Fe'], dtype='object')</code></pre>
</div>
</div>
</section>
<section id="section-11" class="level3">
<h3 class="anchored" data-anchor-id="section-11"></h3>
<p><br><br></p>
<p>After identifying predictors with low variability, we remove them from the problem because they do not add much to the problem. To this end, we use the command below.</p>
<p><br></p>
<div id="38bd6b29" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing problematic predictors</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sb_Xtrain_glass <span class="op">=</span> X_train_g.drop(columns<span class="op">=</span>low_variance_cols)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="between-predictor-correlation" class="level3">
<h3 class="anchored" data-anchor-id="between-predictor-correlation">Between-predictor correlation</h3>
<p><br></p>
<p><span style="color:purple;"><strong>Collinearity</strong></span> is the technical term for the situation where two predictors have a substantial correlation with each other.</p>
<p>If two or more predictors are highly correlated (either negatively or positively), then methods such as the linear regression model will not work!</p>
<p>To visualize the severity of collinearity between predictors, we calculate and visualize the <em>correlation matrix</em>.</p>
</section>
<section id="example-1-cont.-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1-cont.-1">Example 1 (cont.)</h3>
<p><br></p>
<p>We concentrate on the five numerical predictors in the <code>complete_Auto</code> dataset.</p>
<div id="9468100c" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific variables.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>complete_sbAuto <span class="op">=</span> complete_Auto[[<span class="st">'cylinders'</span>, <span class="st">'displacement'</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'horsepower'</span>, <span class="st">'weight'</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'acceleration'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation matrix</h3>
<p><br></p>
<p>In Python, we calculate the correlation matrix using the command below.</p>
<div id="bf33ede3" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> complete_sbAuto.corr()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(correlation_matrix)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              cylinders  displacement  horsepower    weight  acceleration
cylinders      1.000000      0.948230    0.838415  0.893440     -0.503982
displacement   0.948230      1.000000    0.900045  0.929755     -0.549727
horsepower     0.838415      0.900045    1.000000  0.850926     -0.702888
weight         0.893440      0.929755    0.850926  1.000000     -0.413908
acceleration  -0.503982     -0.549727   -0.702888 -0.413908      1.000000</code></pre>
</div>
</div>
</section>
<section id="section-12" class="level3">
<h3 class="anchored" data-anchor-id="section-12"></h3>
<p>Next, we plot the correlation matrix using the function <code>heatmap()</code> from <strong>seaborn</strong>. The argument <code>annot</code> shows the actual value of the pair-wise correlations, and <code>cmap</code> shows a nice color theme.</p>
<div id="ca303e44" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, annot <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-27-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="369" height="345"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-13" class="level3">
<h3 class="anchored" data-anchor-id="section-13"></h3>
<p><br></p>
<p>The predictors cylinders and displacement are highly correlated. In fact, their correlation is 0.95.</p>
<div id="0d82dae5" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-28-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="599" height="435"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="in-practice" class="level3">
<h3 class="anchored" data-anchor-id="in-practice">In practice</h3>
<p><br></p>
<p>We deal with collinearity by removing the minimum number of predictors to ensure that all pairwise correlations are below a certain threshold, say, 0.75.</p>
<p>We can identify the variables that are highly correlated using quite complex code. However, here we will do it manually using the correlation map.</p>
<div id="5889aef0" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset without highly correlated predictors.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>reduced_auto <span class="op">=</span> complete_sbAuto[ [<span class="st">'weight'</span>, <span class="st">'acceleration'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="standarization" class="level2">
<h2 class="anchored" data-anchor-id="standarization">Standarization</h2>
<section id="predictors-with-different-units" class="level3">
<h3 class="anchored" data-anchor-id="predictors-with-different-units">Predictors with different units</h3>
<p>Many good predictive models have issues with <span style="color:blue;"><strong>numeric predictors</strong></span> with different units:</p>
<ol type="1">
<li><p>Methods such as K-nearest neighbors are based on the distance between observations. If the predictors are on different units or scales, then some predictors will have a larger weight for computing the distance.</p></li>
<li><p>Other methods such as LASSO use the variances of the predictors in their calculations. Predictors with different scales will have different variances and so, those with a higher variance will play a bigger role in the calculations.</p></li>
</ol>
</section>
<section id="section-14" class="level3">
<h3 class="anchored" data-anchor-id="section-14"></h3>
<p><br><br><br><br></p>
<div style="font-size: 150%;">
<p><span style="color:purple;"><strong><em>In a nutshell, some predictors will have a higher impact in the model due to its unit and not its information provided to it.</em></strong></span></p>
</div>
</section>
<section id="standarization-1" class="level3">
<h3 class="anchored" data-anchor-id="standarization-1">Standarization</h3>
<p><br></p>
<p>Standardization refers to <em>centering</em> and <em>scaling</em> each numeric predictor individually. It puts every predictor on the same scale.</p>
<p>To <strong>center</strong> a predictor variable, the average predictor value is subtracted from all the values.</p>
<p>Therefore, the centered predictor has a zero mean (that is, its average value is zero).</p>
</section>
<section id="section-15" class="level3">
<h3 class="anchored" data-anchor-id="section-15"></h3>
<p><br></p>
<p>To <strong>scale</strong> a predictor, each of its value is divided by its standard deviation.</p>
<p>Scaling the data coerce the values to have a common standard deviation of one.</p>
<p>In mathematical terms, we standardize a predictor as:</p>
<p><span class="math display">\[{\color{blue} \tilde{X}_{i}} = \frac{{ X_{i} - \bar{X}}}{ \sqrt{\frac{1}{n -1} \sum_{i=1}^{n} (X_{i} - \bar{X})^2}},\]</span></p>
<p>with <span class="math inline">\(\bar{X} = \sum_{i=1}^n \frac{x_i}{n}\)</span>.</p>
</section>
<section id="example-1-cont.-2" class="level3">
<h3 class="anchored" data-anchor-id="example-1-cont.-2">Example 1 (cont.)</h3>
<p>We use on the five numerical predictors in the <code>complete_sbAuto</code> dataset.</p>
<div id="f4595f68" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>complete_sbAuto.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>6</td>
<td>250.0</td>
<td>100</td>
<td>3282</td>
<td>15.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">72</th>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>4098</td>
<td>14.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">389</th>
<td>4</td>
<td>135.0</td>
<td>84</td>
<td>2295</td>
<td>11.6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">145</th>
<td>4</td>
<td>90.0</td>
<td>75</td>
<td>2108</td>
<td>15.5</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11</th>
<td>8</td>
<td>340.0</td>
<td>160</td>
<td>3609</td>
<td>8.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="two-predictors-in-original-units" class="level3">
<h3 class="anchored" data-anchor-id="two-predictors-in-original-units">Two predictors in original units</h3>
<p>Consider the <code>complete_sbAuto</code> dataset created previously. Consider two points in the plot: <span class="math inline">\((175, 5140)\)</span> and <span class="math inline">\((69, 1613)\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div id="6f9dbb6f" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-31-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="458" height="435"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<p>The distance between these points is <span class="math inline">\(\sqrt{(69 - 175)^2 + (1613-5140)^2}\)</span> <span class="math inline">\(= \sqrt{11236 + 12439729}\)</span> <span class="math inline">\(= 3528.592\)</span>.</p>
</div>
</div>
</section>
<section id="standarization-in-python" class="level3">
<h3 class="anchored" data-anchor-id="standarization-in-python">Standarization in Python</h3>
<p><br></p>
<p>To standardize <strong>numerical</strong> predictors, we use the function <code>StandardScaler()</code>. Moreover, we apply the function to the variables using the function <code>fit_transform()</code>.</p>
<p><br></p>
<div id="34b631a6" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Xs <span class="op">=</span> scaler.fit_transform(complete_sbAuto)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="section-16" class="level3">
<h3 class="anchored" data-anchor-id="section-16"></h3>
<p>Unfortunately, the resulting object is not a pandas data frame. We then convert this object to this format. <br></p>
<div id="dc38b1c2" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>scaled_df <span class="op">=</span> pd.DataFrame(Xs, columns <span class="op">=</span> complete_sbAuto.columns)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>scaled_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.370463</td>
<td>0.574266</td>
<td>-0.089095</td>
<td>0.426617</td>
<td>-0.205840</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1.564660</td>
<td>1.118000</td>
<td>0.685890</td>
<td>1.410503</td>
<td>-0.561901</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>-0.823735</td>
<td>-0.522741</td>
<td>-0.502421</td>
<td>-0.763451</td>
<td>-1.416449</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>-0.823735</td>
<td>-0.952004</td>
<td>-0.734916</td>
<td>-0.988925</td>
<td>-0.027809</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1.564660</td>
<td>1.432793</td>
<td>1.460876</td>
<td>0.820895</td>
<td>-2.698270</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="two-predictors-in-standardized-units" class="level3">
<h3 class="anchored" data-anchor-id="two-predictors-in-standardized-units">Two predictors in standardized units</h3>
<p>In the new scale, the two points are now: <span class="math inline">\((1.82, 2.53)\)</span> and <span class="math inline">\((-0.91, -1.60)\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div id="ecb610c5" class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PreProcessing_Part2_BACKUP_files/figure-html/cell-34-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="444" height="435"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<p>The distance between these points is <span class="math inline">\(\sqrt{(-0.91 - 1.82)^2 + (-1.60-2.53)^2}\)</span> <span class="math inline">\(= \sqrt{7.45 + 17.05} = 4.95\)</span>.</p>
</div>
</div>
</section>
<section id="discussion-1" class="level3">
<h3 class="anchored" data-anchor-id="discussion-1">Discussion</h3>
<div class="incremental">
<ul class="incremental">
<li><p>Standardized predictors are generally used to improve the numerical stability of some calculations.</p></li>
<li><p>It is generally recommended to always standardize numeric predictors. Perhaps the only exception would be if we consider a linear regression model.</p></li>
<li><p>A drawback of these transformations is the <span style="color:pink;"><strong><em>loss of interpretability</em></strong></span> since the data are no longer in the original units.</p></li>
<li><p>Standardizing the predictors does not affect their correlation.</p></li>
</ul>
</div>
</section>
</section>
<section id="return-to-main-page" class="level2">
<h2 class="anchored" data-anchor-id="return-to-main-page"><a href="https://alanrvazquez.github.io/TEC-IN5148/">Return to main page</a></h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>